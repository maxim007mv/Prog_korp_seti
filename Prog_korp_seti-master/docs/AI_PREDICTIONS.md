# AI –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ AI –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –Ω–µ–¥–µ–ª—é –≤–ø–µ—Ä–µ–¥ –ø–æ:
- –ó–∞–≥—Ä—É–∑–∫–µ —Å—Ç–æ–ª–∏–∫–æ–≤ –ø–æ –¥–Ω—è–º –∏ —á–∞—Å–∞–º
- –û–∂–∏–¥–∞–µ–º–æ–π –≤—ã—Ä—É—á–∫–µ
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–º –±–ª—é–¥–∞–º
- –°–∞–º—ã–º –∑–∞–Ω—è—Ç—ã–º —Å—Ç–æ–ª–∏–∫–∞–º

## API Endpoint

### GET `/api/ai/predictions/tables`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å AI –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–æ–ª–∏–∫–æ–≤ –Ω–∞ –Ω–µ–¥–µ–ª—é

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è (—Ä–æ–ª—å: Admin)

**Response:**
```json
{
  "predictions": [
    {
      "date": "2025-10-27T00:00:00Z",
      "dayOfWeek": "–ü–Ω",
      "avgOccupancyRate": 10.0,
      "hourlyPredictions": [
        {
          "hour": 10,
          "occupancyRate": 85.5,
          "expectedOrders": 25,
          "confidence": 0.90
        }
      ],
      "expectedRevenue": 2433915.24,
      "topTables": [
        { "tableId": 5, "expectedOrders": 15 }
      ]
    }
  ],
  "topTables": [
    {
      "tableId": 5,
      "totalOrders": 156,
      "totalRevenue": 1248350.50,
      "avgRevenue": 8002.24,
      "peakHours": [18, 19, 20],
      "peakDays": ["–ü—Ç", "–°–±", "–í—Å"]
    }
  ],
  "mostPopularDish": "–°—Ç–µ–π–∫ –†–∏–±–∞–π",
  "generatedAt": "2025-10-27T11:45:08.123Z"
}
```

## –§—Ä–æ–Ω—Ç–µ–Ω–¥

### –°—Ç—Ä–∞–Ω–∏—Ü–∞: `/admin/predictions`

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å:
- **KPI –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏:** –ø–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –±–ª—é–¥–æ, —Ç–æ–ø —Å—Ç–æ–ª–∏–∫–∏
- **–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ –¥–Ω—è–º:** –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è —Å:
  - –°—Ä–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–æ–π (–ø—Ä–æ—Ü–µ–Ω—Ç + –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä)
  - –û–∂–∏–¥–∞–µ–º–æ–π –≤—ã—Ä—É—á–∫–æ–π
  - –¢–æ–ø —Å—Ç–æ–ª–∏–∫–∞–º–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
  - –ü–∏–∫–æ–≤—ã–º–∏ —á–∞—Å–∞–º–∏ —Ä–∞–±–æ—Ç—ã
- **–¢–∞–±–ª–∏—Ü–∞ —Ç–æ–ø —Å—Ç–æ–ª–∏–∫–æ–≤:** –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–∞–º—ã–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Å—Ç–æ–ª–∏–∫–∞–º

### React Query Hook

```typescript
import { useQuery } from '@tanstack/react-query';
import { aiApi } from '@/lib/api';

const { data, isLoading } = useQuery({
  queryKey: ['table-predictions'],
  queryFn: () => aiApi.getTablePredictions(),
  refetchInterval: 60000, // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
});
```

## –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

### 1. –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã (`status = "closed"`)
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: –ø–æ —Å—Ç–æ–ª–∏–∫–∞–º, –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏, —á–∞—Å–∞–º

### 2. –†–∞—Å—á–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏
```
occupancyRate = (ordersInThisHour / totalOrdersOnThisDay) * 100 * 5
```
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ –º–∞–∫—Å–∏–º—É–º–∞ 95%
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ (–ü–Ω, –í—Ç, ..., –í—Å)

### 3. –ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏
```
expectedRevenue = avgRevenueForThisDayOfWeek * totalExpectedOrders
```

### 4. –¢–æ–ø —Å—Ç–æ–ª–∏–∫–∏
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–∫–∞–∑–æ–≤
- –í—ã—è–≤–ª–µ–Ω–∏–µ –ø–∏–∫–æ–≤—ã—Ö —á–∞—Å–æ–≤ (—Ç–æ–ø-3 –ø–æ —á–∞—Å—Ç–æ—Ç–µ)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ–ª–∏–∫–æ–≤
- **üü¢ 0-50%:** –ù–∏–∑–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- **üü° 50-70%:** –°—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞
- **üî¥ 70-100%:** –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–ø–∏–∫)

### Confidence (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)
- **0.75:** –ë–∞–∑–æ–≤–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
- **0.90:** –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–º–Ω–æ–≥–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö)

### –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã
–ß–∞—Å—ã —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π –∑–∞–≥—Ä—É–∑–∫–æ–π - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–ª—é–¥–∞ –∑–∞—Ä–∞–Ω–µ–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Å–∞–¥–∫—É –≥–æ—Å—Ç–µ–π

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
```typescript
predictions.forEach(day => {
  const peakHours = day.hourlyPredictions
    .filter(h => h.occupancyRate > 70)
    .map(h => h.hour);
  
  console.log(`${day.dayOfWeek}: –¥–æ–ø. –ø–µ—Ä—Å–æ–Ω–∞–ª –Ω—É–∂–µ–Ω –≤ ${peakHours.join(', ')}`);
});
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–∫—É–ø–æ–∫
```typescript
const topDish = data.mostPopularDish;
const weekRevenue = predictions.reduce((sum, p) => sum + p.expectedRevenue, 0);

console.log(`–ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏ –Ω–∞ –Ω–µ–¥–µ–ª—é: ${weekRevenue} —Ä—É–±`);
console.log(`–£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–∫—É–ø–∫—É: ${topDish}`);
```

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–∞–º–∏
```typescript
const busyTables = data.topTables
  .filter(t => t.totalOrders > 100)
  .map(t => t.tableId);

console.log(`–°—Ç–æ–ª–∏–∫–∏ —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è: ${busyTables.join(', ')}`);
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:** –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É —á–µ—Ä–µ–∑ React Query
- **–í—Ä—É—á–Ω—É—é:** –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **Backend cache:** –ù–µ—Ç (–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Query time:** ~6-10ms
- **Database query:** 1 –∑–∞–ø—Ä–æ—Å (—Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –ø–æ `created_at`, `status`)
- **Calculations:** In-memory (LINQ + –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **ML –º–æ–¥–µ–ª—å** –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
2. **–°–µ–∑–æ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** (–ø—Ä–∞–∑–¥–Ω–∏–∫–∏, —Å–æ–±—ã—Ç–∏—è)
3. **–ü–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–≤–ª–∏—è–Ω–∏–µ –ø–æ–≥–æ–¥—ã –Ω–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å)
4. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
5. **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –æ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö

## Troubleshooting

### Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `generate_fresh_test_data.sql` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö  
**–†–µ—à–µ–Ω–∏–µ:** –ù–∞–∫–æ–ø–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –º–∏–Ω–∏–º—É–º –∑–∞ 2-4 –Ω–µ–¥–µ–ª–∏

### –û—à–∏–±–∫–∞ 500 –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –ë–î –∏–ª–∏ EF Core query  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–æ–≤ = "closed"
