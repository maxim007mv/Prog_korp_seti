# Дорожная карта разработки

## Фаза 1: Базовая инфраструктура ✅ ЗАВЕРШЕНО

- [x] Инициализация Next.js проекта
- [x] Настройка TypeScript
- [x] Конфигурация TailwindCSS
- [x] Создание типов данных
- [x] Базовые утилиты
- [x] Базовые UI компоненты
- [x] Структура страниц

## Фаза 2: API и работа с данными

### 2.1 API клиент
- [ ] Создать базовый HTTP клиент (`lib/api/client.ts`)
- [ ] Настроить перехватчики для авторизации
- [ ] Обработка ошибок API
- [ ] Типизация всех эндпоинтов

### 2.2 React Query хуки
- [ ] `useMenu()` - получение меню
- [ ] `useCreateBooking()` - создание брони
- [ ] `useSearchBookings()` - поиск броней
- [ ] `useAvailableTables()` - поиск свободных столов
- [ ] `useOrders()` - работа с заказами
- [ ] `useCreateOrder()` - создание заказа
- [ ] `useUpdateOrder()` - обновление заказа
- [ ] `useCloseOrder()` - закрытие заказа

## Фаза 3: Публичная часть (Client)

### 3.1 Страница меню (/menu)
- [ ] Компонент `MenuCategoryTabs` - навигация по категориям
- [ ] Компонент `DishCard` - карточка блюда
- [ ] Компонент `MenuFilters` - фильтры (теги, цена)
- [ ] Поиск по блюдам
- [ ] Опционально: NLP-поиск (если FEATURE_AI=true)

### 3.2 Бронирование (/booking)
- [ ] Компонент `BookingForm` - форма бронирования
- [ ] Валидация формы с Zod
- [ ] Компонент `TableCard` - отображение доступных столов
- [ ] Логика выбора стола
- [ ] Подтверждение брони
- [ ] Отображение номера брони

### 3.3 Поиск брони (/booking/search)
- [ ] Форма поиска (имя + 4 цифры)
- [ ] Компонент `BookingList` - список найденных броней
- [ ] Действия с бронью (отмена)

## Фаза 4: Зона официантов (Staff)

### 4.1 Главная страница (/staff)
- [ ] Список активных заказов
- [ ] Кнопка создания нового заказа
- [ ] Фильтры заказов

### 4.2 Страница заказа (/staff/orders/[id])
- [ ] Компонент `OrderEditor` - редактор заказа
- [ ] Добавление блюд из меню
- [ ] Изменение количества позиций
- [ ] Удаление позиций
- [ ] Расчёт итоговой суммы
- [ ] Кнопка закрытия заказа
- [ ] Опционально: AI upsell предложения

### 4.3 Печать чека (/staff/receipt/[id]/print)
- [ ] Компонент `ReceiptView` - отображение чека
- [ ] Группировка по категориям
- [ ] Форматирование согласно ПЗ-4
- [ ] Print-стили (@media print)

## Фаза 5: Админ-панель (Admin)

### 5.1 Дашборд (/admin)
- [ ] KPI плитки (выручка, заказы, средний чек, топ-блюдо)
- [ ] График выручки (Recharts Line)
- [ ] График топ-блюд (Recharts Bar)
- [ ] График эффективности официантов
- [ ] Опционально: AI-дайджест дня

### 5.2 Управление меню (/admin/menu)
- [ ] Список блюд с фильтрами
- [ ] CRUD формы для блюда
- [ ] Валидация (вес, цена, время)
- [ ] Загрузка изображений (опционально)

### 5.3 Управление столами (/admin/tables)
- [ ] Список столов
- [ ] CRUD операции
- [ ] Проверка конфликтов с бронями
- [ ] Heatmap занятости (опционально)

### 5.4 Управление бронями (/admin/bookings)
- [ ] Таблица всех броней
- [ ] Фильтры (дата, статус, стол)
- [ ] Действия (перенос, отмена)
- [ ] Проверка конфликтов

### 5.5 Журнал заказов (/admin/orders)
- [ ] Таблица заказов
- [ ] Фильтры (период, официант, статус)
- [ ] Детальный просмотр заказа
- [ ] Просмотр чека (read-only)

### 5.6 Управление официантами (/admin/waiters)
- [ ] Список официантов
- [ ] Создание/деактивация
- [ ] Метрики по каждому

### 5.7 Отчёты (/admin/reports)
- [ ] Отчёт по выручке
  - [ ] Выбор периода
  - [ ] График Line
  - [ ] Таблица данных
  - [ ] Экспорт CSV/PDF
- [ ] Отчёт по официантам
  - [ ] Таблица с сортировкой
  - [ ] Drill-down
- [ ] Отчёт популярности блюд
  - [ ] График Bar
  - [ ] Тренды

## Фаза 6: Аутентификация и безопасность

### 6.1 Аутентификация
- [ ] Страница входа (/login)
- [ ] API для входа/выхода
- [ ] Хранение JWT в httpOnly cookies
- [ ] Refresh token механизм

### 6.2 Авторизация (RBAC)
- [ ] Middleware для защиты роутов
- [ ] Компонент `RoleGuard`
- [ ] Компонент `ProtectedRoute`
- [ ] Проверка ролей на серверных роутах

### 6.3 Безопасность
- [ ] CSRF защита
- [ ] Маскирование телефонов
- [ ] Rate limiting (на бэкенде)
- [ ] XSS защита

## Фаза 7: Дополнительные UI компоненты

- [ ] `Modal` - модальное окно
- [ ] `Toast` - уведомления
- [ ] `Select` - выпадающий список
- [ ] `Tabs` - вкладки
- [ ] `Table` - таблица данных
- [ ] `Pagination` - пагинация
- [ ] `DatePicker` - выбор даты
- [ ] `TimePicker` - выбор времени

## Фаза 8: Валидация и формы

- [ ] Схемы Zod для всех форм
- [ ] Интеграция react-hook-form
- [ ] Компонент `Form` - обёртка формы
- [ ] Компонент `FormField` - поле формы с валидацией

## Фаза 9: AI функциональность (опционально) ✅ ЗАВЕРШЕНО

- [x] NLP-поиск по меню
  - [x] Интеграция API (DeepSeek)
  - [x] UI для ввода запроса (голосовой ввод, примеры)
  - [x] Отображение результатов
- [x] AI upsell
  - [x] Компонент `AiUpsellPanel`
  - [x] Логика предложений (анализ заказа)
  - [ ] A/B тестирование эффективности (опционально)

## Фаза 10: Тестирование

### 10.1 Unit тесты
- [ ] Тесты утилит (formatPrice, formatDate, etc.)
- [ ] Тесты валидации
- [ ] Тесты хуков

### 10.2 Component тесты
- [ ] Тесты UI компонентов
- [ ] Тесты форм
- [ ] Тесты бизнес-компонентов

### 10.3 E2E тесты (Playwright)
- [ ] Тест: Создание и поиск брони
- [ ] Тест: Официант создаёт заказ
- [ ] Тест: Печать чека
- [ ] Тест: Админ создаёт блюдо
- [ ] Тест: Просмотр отчётов

## Фаза 11: Оптимизация и полировка

### 11.1 Производительность
- [ ] Код-сплит страниц
- [ ] Ленивая загрузка компонентов
- [ ] Оптимизация изображений (next/image)
- [ ] Кэширование запросов
- [ ] Дебаунс для поиска и фильтров

### 11.2 Доступность (A11y)
- [ ] Проверка контраста (WCAG AA)
- [ ] Клавиатурная навигация
- [ ] ARIA-атрибуты
- [ ] Тестирование со screen readers

### 11.3 Адаптивность
- [ ] Mobile-first подход
- [ ] Тестирование на разных экранах
- [ ] Touch-friendly интерактивы

### 11.4 SEO
- [ ] Metadata для всех страниц
- [ ] Robots.txt
- [ ] Sitemap.xml

## Фаза 12: Расширения v1.1+ (опционально)

- [ ] Интернационализация (i18n)
  - [ ] Настройка next-intl
  - [ ] Переводы на английский
  - [ ] Переключатель языка
- [ ] Предзаказ в клиенте
  - [ ] Корзина
  - [ ] Оформление предзаказа
- [ ] Тёмная тема
  - [ ] CSS variables для тем
  - [ ] Переключатель темы
  - [ ] Сохранение предпочтений
- [ ] PWA
  - [ ] Service Worker
  - [ ] Offline поддержка
  - [ ] Push уведомления
  - [ ] Установка на домашний экран

## Критерии завершения проекта (DoD)

- [ ] Все страницы доступны и работают
- [ ] Меню отображается по категориям
- [ ] Бронирование работает (создание, поиск, отмена)
- [ ] Заказы работают (создание, редактирование, закрытие)
- [ ] Чек печатается по шаблону ПЗ-4
- [ ] Отчёты формируются корректно
- [ ] Выручка считается только по закрытым заказам
- [ ] RBAC работает для всех ролей
- [ ] Ошибки обработаны
- [ ] Скелетоны реализованы
- [ ] Тесты пройдены
- [ ] Сборка успешна
- [ ] Документация актуальна

---

## Примерная оценка трудозатрат

- **Фаза 1**: ✅ Завершена
- **Фаза 2**: 8-12 часов
- **Фаза 3**: 16-20 часов
- **Фаза 4**: 12-16 часов
- **Фаза 5**: 24-32 часов
- **Фаза 6**: 8-12 часов
- **Фазы 7-8**: 8-12 часов
- **Фазы 9-12**: По желанию

**Итого (минимум)**: ~80-100 часов чистой разработки

## Приоритизация

### Must Have (Обязательно)
- Фазы 1-6
- Часть Фазы 7 (Modal, Toast, Select, Table)
- Базовая часть Фазы 8 (валидация критичных форм)

### Should Have (Желательно)
- Полная Фаза 7
- Полная Фаза 8
- Фаза 10 (тесты)
- Фаза 11 (оптимизация)

### Could Have (Можно добавить)
- Фаза 9 (AI)
- Фаза 12 (расширения)

---

**Рекомендуемая последовательность**: Двигайтесь по фазам 2 → 3 → 4 → 5 → 6, затем добавляйте остальное по мере необходимости.
